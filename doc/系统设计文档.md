# 智能运营系统
    你提出的5个模块涵盖了“人（权限）、事（任务）、物（配置）、数（报表）、流（审批）”这几个核心运营要素。

## 一、功能说明
### 1.1 登录鉴权中心 (IAM & Security)
    目标：不仅是“能登录”，更要确保“安全”和“精细化控制”。
    基础账户管理：支持账号注册、密码找回（邮件/短信）、账号锁定（输错限制）、强制改密策略。
    多方式登录集成：
    支持本地账号密码登录。
    SSO单点登录：集成企业内部LDAP/AD域、飞书/钉钉/企业微信扫码登录，减少运营人员记忆成本。
    MFA双因素认证：对于敏感操作或外网访问，强制开启谷歌验证码或短信验证。
    RBAC精细化权限：
    功能权限：控制到菜单级、按钮级（如：只能看不能删）。
    数据权限：控制到行级（如：华东区的运营只能看华东区的数据）或列级（如：普通运营看不到用户手机号明细）。
    会话管理：支持在线用户踢出、长时间无操作自动登出、并发登录限制。

### 1.2 智能调度中心 (Job Scheduler)
    目标：从简单的“定时器”升级为“分布式任务编排引擎”。
    任务配置增强：
    多种协议支持：除了URL（HTTP），支持Shell脚本、SQL脚本、甚至是直接调用微服务接口。
    重试策略：配置失败重试次数、重试间隔、超时时间（Timeout）。
    参数传递：支持动态参数（如 {yesterday}, {taskId}）传递给下游任务。
    DAG工作流编排：
    可视化依赖：通过拖拽方式配置任务依赖关系（A成功后执行B和C，B和C都成功后执行D）。
    条件分支：支持简单的逻辑判断（如：如果A任务返回结果>100，执行B，否则执行C）。
    运行管控：
    执行策略：支持串行、并行、分片广播（处理大数据量任务）。
    补数机制：支持选定时间段，重新触发历史周期的任务（常用于报表修复）。
    任务暂停/恢复：紧急情况下可一键熔断某个任务。
    监控告警：
    多渠道告警：任务失败、超时、未按时启动时，发送邮件/钉钉/企微通知。
    长尾任务分析：识别执行时间异常增长的任务。

### 1.3 低代码报表引擎 (BI & Reporting)
    目标：实现“零开发”生成报表，支持更丰富的数据交互。
    数据源管理：
    支持多数据源连接（MySQL, PostgreSQL, ClickHouse等）。
    支持自定义SQL视图作为报表底表。
    可视化配置：
    图表支持：除了表格，增加折线图、柱状图、饼图、漏斗图等基础图表配置。
    查询控件：支持文本框、下拉选（支持级联）、日期范围、多选框等配置。
    格式化：支持金额千分位、百分比、红涨绿跌高亮显示。
    交互增强：
    数据穿透：支持点击汇总数字跳转到明细列表。
    自定义列：用户在前端可自己勾选展示/隐藏哪些列。
    水印功能：防止敏感数据截图外泄。
    自动化触达：
    邮件订阅：支持配置日报/周报，定时将报表截图或Excel通过邮件推送给指定人。

### 1.4 通用配置中心 (CMS / Config Center)
    目标：打造一个安全的数据/参数管理后台，防止“手抖”误操作。
    元数据驱动：
    基于数据库表结构自动生成增删改查页面（Auto-CRUD）。
    支持丰富字段类型：图片上传、富文本编辑器、JSON编辑器、代码高亮框。
    版本控制与回滚：
    配置版本化：每次修改配置，系统自动保存版本快照（Git风格）。
    Diff对比：修改前展示“修改前 vs 修改后”的差异对比。
    一键回滚：配置错误时，可立即恢复到上一版本。
    数据校验：
    支持配置正则校验规则（如：手机号格式、JSON格式校验），后端自动拦截非法数据。
    发布审核：
    对于敏感配置表（如费率、黑白名单），修改后需触发1.5模块的审批流，审批通过后才生效。

### 1.5 流程审批中心 (Workflow Engine)
    目标：将人工决策标准化、留痕化。
    可视化流程设计：
    提供类似BPMN的图形化设计器，配置审批节点、抄送节点、办理人。
    动态审批人：
    支持指定人、指定角色、指定部门主管、发起人自选等多种找人方式。
    会签/或签：支持多人同时同意（会签）或 任意一人同意（或签）。
    审批交互：
    IM审批：集成钉钉/飞书审批卡片，直接在聊天软件中点击“同意/拒绝”。
    评论与附件：审批时支持填写备注、上传证明图片。
    回调机制：
    审批通过/拒绝后，支持通过Webhook回调触发业务逻辑（如：审批通过->自动调用1.2调度任务->更新1.4配置生效）。

### 1.6 全局审计与监控 (Audit & Monitor)
    操作审计日志：记录谁（User）、在什么时间（Time）、在这个页面（Page）、操作了什么数据（Data Before/After）、IP地址是多少。这是安全合规的底线。
    系统健康看板：展示任务调度成功率、当前在线人数、API响应速度等系统级指标。

### 1.7 消息通知中心 (Notification Center)
    作为系统的“喉舌”，统一管理短信、邮件、站内信、IM消息的发送。
    支持消息模板管理、发送记录查询、黑名单管理。


## 二、技术选型清单 (Tech Stack)
    模块	推荐技术/库	选择理由
    开发语言	Python 3.10+	类型提示支持更好，性能有所提升
    Web框架	Django + DRF (Django REST Framework)	自带强大的ORM、鉴权系统、Admin后台，开发速度最快
    任务调度	Celery + Django-Celery-Beat	Python界标准的分布式任务队列，支持定时、延时、任务链
    数据处理	Pandas	用于报表模块的Excel导出、数据聚合计算
    ORM框架	Django ORM	避免手写SQL，方便做通用的增删改查
    审批流	Django-FSM (Finite State Machine)	轻量级状态机，适合实现审批流程的状态流转
    数据库	MySQL 8.0	稳定，支持JSON字段（存储配置更灵活）
    中间件	Redis	用于Celery的消息队列（Broker）和结果存储（Backend），以及缓存
    前端	Vue3 + Ant Design Vue	(建议) 主流前端框架，配套组件丰富

## 三、 核心模块详细设计
### 3.1 登录鉴权模块 (Auth)
    利用 Django 完善的内置认证体系。
    技术实现：
    使用 SimpleJWT 实现 JWT (JSON Web Token) 鉴权，支持无状态API。
    RBAC权限：利用 Django 内置的 User, Group (角色), Permission 模型。
    SSO集成：使用 python-social-auth 库，快速集成LDAP、OAuth2（钉钉/飞书）登录。
    过期控制：在 JWT Payload 中设置 exp，结合 Redis 存储 Token 黑名单实现强制登出。
    
### 3.2 定时调度模块 (Scheduler)
    这是系统的核心难点，需要从简单的 Crontab 升级为 DAG（有向无环图）。
    技术实现：
    基础调度：使用 django-celery-beat，将定时任务配置存储在 MySQL 中，可动态在页面修改 Crontab 表达式。
    任务执行：Celery Worker 负责实际的 URL 请求（使用 requests 库）。
    依赖编排 (DAG)：利用 Celery 的 Canvas (Workflows) 功能：
    链式任务 (Chain)：task_A.s() | task_B.s() (A成功后执行B)。
    任务组 (Group)：group(task_C.s(), task_D.s()) (C和D并行)。
    数据库设计：
    Job: 定义单个URL任务。
    JobFlow: 定义流程，存储依赖关系的 JSON (如 [A, B, [C, D], E])。
    JobLog: 记录每次执行的 TraceID、耗时、状态码、响应体。
    
### 3.3 通用报表模块 (Reporting)
    利用 Python 强大的数据处理能力。
    技术实现：
    动态SQL：后端接收前端传来的 JSON 配置（表名、字段、Where条件），使用 SQLAlchemy Core 或 Django 原生 SQL 执行查询（注意： 必须在代码层做严格的SQL注入防范，或限制只能选预设的 View）。
    数据导出：
    查询结果转换为 Pandas DataFrame。
    使用 df.to_excel() 或 df.to_csv() 生成文件流返回给前端。
    权限控制：
    设计 ReportPermission 表，关联 RoleID 和 ReportID。
    利用 Django 的 Middleware 或 DRF 的 Permission 类进行拦截。
    
### 3.4 通用配置模块 (Configuration)
    目标是实现 "Auto-CRUD"。
    技术实现：
    元数据驱动：设计一个 MetaModel 表，记录 table_name, field_config (JSON格式，定义字段是输入框还是下拉框)。
    动态API：
    编写一个通用的 ViewSet，URL 如 /api/config/{table_name}/。
    利用 Django 的 contenttypes 框架或动态 type() 创建 Model 类，实现对任意注册表的增删改查。
    历史记录：使用 django-simple-history 库，自动为配置表生成历史镜像表，轻松实现“版本回滚”和“修改审计”。
    
### 3.5 通用审批流程 (Workflow)
    不要造复杂的 BPM 引擎，使用状态机最轻量高效。
