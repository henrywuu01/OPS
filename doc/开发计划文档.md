# 智能运营系统 (OPS) 开发计划

> 本文档基于《系统设计文档》拆分，明确开发阶段、任务分解、里程碑节点及交付物。

---

## 目录

1. [项目概览](#一项目概览)
2. [开发阶段规划](#二开发阶段规划)
3. [模块开发详情](#三模块开发详情)
4. [里程碑计划](#四里程碑计划)
5. [资源需求](#五资源需求)
6. [风险管理](#六风险管理)
7. [质量保障](#七质量保障)

---

## 一、项目概览

### 1.1 项目目标

构建智能运营系统，涵盖以下核心模块：

| 序号 | 模块名称 | 模块代码 | 优先级 |
|------|----------|----------|--------|
| 1 | 登录鉴权中心 | auth | P0 |
| 2 | 智能调度中心 | scheduler | P0 |
| 3 | 低代码报表引擎 | report | P1 |
| 4 | 通用配置中心 | config | P1 |
| 5 | 流程审批中心 | workflow | P1 |
| 6 | 全局审计与监控 | audit | P2 |
| 7 | 消息通知中心 | notification | P2 |

### 1.2 技术栈概要

- **后端**：Python 3.10+ / Django 4.2 / DRF / Celery
- **前端**：Vue 3 / Ant Design Vue / Vite
- **数据库**：MySQL 8.0 / Redis 7.0
- **部署**：Docker / Kubernetes

### 1.3 开发原则

1. **分阶段交付**：按优先级迭代开发，每阶段交付可用产品
2. **接口先行**：先定义API接口，前后端并行开发
3. **测试驱动**：核心逻辑编写单元测试，接口编写集成测试
4. **持续集成**：代码提交自动触发构建和测试

---

## 二、开发阶段规划

### 2.1 阶段总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           开发阶段总览                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  阶段0        阶段1         阶段2         阶段3         阶段4           │
│  基础搭建     核心功能      扩展功能      增强功能      优化上线        │
│                                                                         │
│  ┌─────┐    ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐     │
│  │项目 │    │ 鉴权    │   │ 报表    │   │ 审计    │   │ 性能    │     │
│  │初始化│───▶│ 调度    │──▶│ 配置    │──▶│ 消息    │──▶│ 安全    │     │
│  │     │    │         │   │ 审批    │   │         │   │ 部署    │     │
│  └─────┘    └─────────┘   └─────────┘   └─────────┘   └─────────┘     │
│                                                                         │
│  Week 1-2    Week 3-8      Week 9-14     Week 15-18    Week 19-22      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 阶段详情

#### 阶段 0：项目初始化（Week 1-2）

| 任务 | 负责角色 | 交付物 |
|------|----------|--------|
| 创建代码仓库、分支策略 | 技术负责人 | Git仓库、分支规范文档 |
| 搭建后端项目骨架 | 后端开发 | Django项目结构 |
| 搭建前端项目骨架 | 前端开发 | Vue3项目结构 |
| 配置CI/CD流水线 | DevOps | GitHub Actions配置 |
| 搭建开发环境 | DevOps | Docker Compose配置 |
| 设计数据库初始Schema | 后端开发 | 数据库迁移脚本 |
| 统一代码规范 | 全员 | ESLint/Pylint配置 |

**阶段交付物**：
- 可运行的前后端项目骨架
- 开发环境一键启动
- CI/CD流水线可用

---

#### 阶段 1：核心功能开发（Week 3-8）

**目标**：完成登录鉴权和任务调度两个核心模块

##### 1.1 登录鉴权中心（Week 3-5）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W3 | 用户模型设计、JWT认证实现 | t_user表、登录/登出API |
| W3 | 角色权限模型设计 | t_role、t_permission表 |
| W4 | RBAC权限控制实现 | 权限装饰器、中间件 |
| W4 | 登录页面开发 | 登录/注册/忘记密码页面 |
| W5 | SSO集成（钉钉/飞书） | OAuth2回调接口 |
| W5 | MFA双因素认证 | TOTP绑定与验证 |

##### 1.2 智能调度中心（Week 6-8）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W6 | Celery集成、Beat配置 | 异步任务基础设施 |
| W6 | 任务模型设计 | t_job、t_job_log表 |
| W7 | HTTP任务执行器 | 任务执行、重试、超时 |
| W7 | 任务管理页面 | 任务列表、新建、编辑 |
| W8 | DAG工作流基础实现 | t_job_flow表、Canvas编排 |
| W8 | 任务监控告警 | 失败告警、执行日志查看 |

**阶段交付物**：
- 完整的用户认证系统
- 可配置的定时任务调度
- 任务执行日志与监控

---

#### 阶段 2：扩展功能开发（Week 9-14）

**目标**：完成报表、配置、审批三个业务模块

##### 2.1 低代码报表引擎（Week 9-10）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W9 | 数据源管理 | t_datasource表、连接测试 |
| W9 | 动态SQL查询引擎 | 参数化查询、防注入 |
| W10 | 报表配置与展示 | t_report表、图表渲染 |
| W10 | 报表导出功能 | Excel/CSV导出 |

##### 2.2 通用配置中心（Week 11-12）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W11 | 元数据模型设计 | t_meta_table表 |
| W11 | 动态CRUD API | 通用增删改查接口 |
| W12 | 配置历史与回滚 | t_config_history表、Diff对比 |
| W12 | 配置管理页面 | 动态表单、JSON编辑器 |

##### 2.3 流程审批中心（Week 13-14）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W13 | 流程定义模型 | t_workflow_definition表 |
| W13 | 状态机实现 | Django-FSM集成 |
| W14 | 审批实例与记录 | t_approval_instance表 |
| W14 | 审批页面开发 | 待办/已办列表、审批操作 |

**阶段交付物**：
- 可配置的报表系统
- 通用配置管理后台
- 基础审批流程功能

---

#### 阶段 3：增强功能开发（Week 15-18）

**目标**：完成审计监控和消息通知，增强各模块功能

##### 3.1 全局审计与监控（Week 15-16）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W15 | 操作审计中间件 | t_audit_log表、请求拦截 |
| W15 | 数据变更记录 | t_data_change_log表 |
| W16 | 登录日志记录 | t_login_log表 |
| W16 | 审计查询页面 | 多维度筛选、导出 |

##### 3.2 消息通知中心（Week 17-18）

| 周次 | 任务 | 交付物 |
|------|------|--------|
| W17 | 消息模板管理 | t_message_template表 |
| W17 | 多渠道发送器 | 邮件/短信/钉钉发送 |
| W18 | 站内信功能 | t_notification表 |
| W18 | 消息记录查询 | t_message_log表、发送状态 |

##### 3.3 功能增强（并行）

| 任务 | 模块 | 交付物 |
|------|------|--------|
| 可视化流程设计器 | workflow | 拖拽式流程编排 |
| 报表订阅推送 | report | 定时邮件发送 |
| DAG可视化编排 | scheduler | 任务依赖图编辑 |
| 数据权限控制 | auth | 行级/列级权限 |

**阶段交付物**：
- 完整的审计日志系统
- 多渠道消息推送
- 各模块功能增强

---

#### 阶段 4：优化与上线（Week 19-22）

**目标**：性能优化、安全加固、生产部署

##### 4.1 性能优化（Week 19-20）

| 任务 | 说明 |
|------|------|
| 数据库优化 | 慢查询分析、索引优化 |
| 缓存优化 | Redis缓存策略、热点数据 |
| 接口优化 | N+1查询优化、分页优化 |
| 前端优化 | 代码分割、懒加载、CDN |

##### 4.2 安全加固（Week 20-21）

| 任务 | 说明 |
|------|------|
| 安全扫描 | 依赖漏洞、代码审计 |
| 渗透测试 | XSS/CSRF/SQL注入测试 |
| 敏感数据加密 | 密码、密钥加密存储 |
| 接口限流 | Rate Limit配置 |

##### 4.3 部署上线（Week 21-22）

| 任务 | 说明 |
|------|------|
| 生产环境搭建 | K8s集群、数据库主从 |
| 监控告警配置 | Prometheus + Grafana |
| 文档完善 | 部署文档、运维手册 |
| UAT测试 | 用户验收测试 |
| 正式上线 | 灰度发布、全量切换 |

**阶段交付物**：
- 性能优化报告
- 安全测试报告
- 生产环境部署
- 运维文档

---

## 三、模块开发详情

### 3.1 登录鉴权中心 (auth)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_user | 用户表 | 阶段1 |
| t_role | 角色表 | 阶段1 |
| t_permission | 权限表 | 阶段1 |
| t_user_role | 用户角色关联 | 阶段1 |
| t_role_permission | 角色权限关联 | 阶段1 |
| t_department | 部门表 | 阶段1 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/auth/login | POST | 登录 | P0 |
| /api/auth/logout | POST | 登出 | P0 |
| /api/auth/refresh | POST | 刷新Token | P0 |
| /api/auth/password/change | POST | 修改密码 | P0 |
| /api/auth/password/reset | POST | 重置密码 | P1 |
| /api/auth/mfa/bind | POST | 绑定MFA | P1 |
| /api/auth/mfa/verify | POST | 验证MFA | P1 |
| /api/users | GET/POST | 用户管理 | P0 |
| /api/roles | GET/POST | 角色管理 | P0 |
| /api/permissions | GET | 权限列表 | P0 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 登录页 | /login | 账号密码登录 | P0 |
| 注册页 | /register | 用户注册 | P1 |
| 忘记密码 | /forgot-password | 密码找回 | P1 |
| 用户管理 | /system/users | 用户列表/编辑 | P0 |
| 角色管理 | /system/roles | 角色列表/权限分配 | P0 |
| 个人中心 | /profile | 个人信息/改密 | P1 |

---

### 3.2 智能调度中心 (scheduler)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_job | 任务定义表 | 阶段1 |
| t_job_flow | 工作流定义表 | 阶段1 |
| t_job_log | 任务执行日志 | 阶段1 |
| t_job_flow_node | 工作流节点 | 阶段3 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/jobs | GET/POST | 任务列表/创建 | P0 |
| /api/jobs/{id} | GET/PUT/DELETE | 任务详情/编辑/删除 | P0 |
| /api/jobs/{id}/trigger | POST | 手动触发 | P0 |
| /api/jobs/{id}/pause | POST | 暂停任务 | P0 |
| /api/jobs/{id}/resume | POST | 恢复任务 | P0 |
| /api/jobs/{id}/logs | GET | 执行日志 | P0 |
| /api/job-flows | GET/POST | 工作流管理 | P1 |
| /api/job-flows/{id}/trigger | POST | 触发工作流 | P1 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 任务列表 | /scheduler/jobs | 任务管理 | P0 |
| 任务详情 | /scheduler/jobs/:id | 任务配置/日志 | P0 |
| 工作流列表 | /scheduler/flows | 工作流管理 | P1 |
| 工作流编辑 | /scheduler/flows/:id | DAG编排 | P1 |
| 执行历史 | /scheduler/history | 执行记录查询 | P0 |

---

### 3.3 低代码报表引擎 (report)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_datasource | 数据源配置 | 阶段2 |
| t_report | 报表定义 | 阶段2 |
| t_report_subscription | 报表订阅 | 阶段3 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/datasources | GET/POST | 数据源管理 | P0 |
| /api/datasources/{id}/test | POST | 连接测试 | P0 |
| /api/reports | GET/POST | 报表列表/创建 | P0 |
| /api/reports/{id} | GET/PUT/DELETE | 报表详情/编辑 | P0 |
| /api/reports/{id}/query | POST | 执行查询 | P0 |
| /api/reports/{id}/export | GET | 导出报表 | P0 |
| /api/reports/{id}/subscribe | POST | 订阅报表 | P1 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 数据源管理 | /report/datasources | 数据源配置 | P0 |
| 报表列表 | /report/list | 报表管理 | P0 |
| 报表设计 | /report/design/:id | 报表配置 | P0 |
| 报表查看 | /report/view/:id | 报表展示 | P0 |
| 我的订阅 | /report/subscriptions | 订阅管理 | P1 |

---

### 3.4 通用配置中心 (config)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_meta_table | 元数据表定义 | 阶段2 |
| t_config_history | 配置历史记录 | 阶段2 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/config/tables | GET | 配置表列表 | P0 |
| /api/config/{table} | GET/POST | 配置数据列表/新增 | P0 |
| /api/config/{table}/{id} | GET/PUT/DELETE | 配置详情/编辑/删除 | P0 |
| /api/config/{table}/{id}/history | GET | 历史版本 | P0 |
| /api/config/{table}/{id}/rollback | POST | 版本回滚 | P0 |
| /api/config/{table}/{id}/diff | GET | 版本对比 | P1 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 配置表列表 | /config/tables | 表管理 | P0 |
| 配置数据 | /config/:table | 数据管理 | P0 |
| 配置编辑 | /config/:table/:id | 数据编辑 | P0 |
| 历史版本 | /config/:table/:id/history | 版本管理 | P0 |

---

### 3.5 流程审批中心 (workflow)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_workflow_definition | 流程定义 | 阶段2 |
| t_approval_instance | 审批实例 | 阶段2 |
| t_approval_record | 审批记录 | 阶段2 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/workflows | GET/POST | 流程定义管理 | P0 |
| /api/workflows/{id} | GET/PUT/DELETE | 流程详情/编辑 | P0 |
| /api/workflows/{id}/publish | POST | 发布流程 | P0 |
| /api/approvals | GET | 我的审批 | P0 |
| /api/approvals/{id} | GET | 审批详情 | P0 |
| /api/approvals/{id}/approve | POST | 同意 | P0 |
| /api/approvals/{id}/reject | POST | 拒绝 | P0 |
| /api/approvals/{id}/transfer | POST | 转交 | P1 |
| /api/approvals/{id}/withdraw | POST | 撤回 | P1 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 流程定义 | /workflow/definitions | 流程管理 | P0 |
| 流程设计 | /workflow/design/:id | 流程编排 | P1 |
| 待办事项 | /workflow/todo | 待办审批 | P0 |
| 已办事项 | /workflow/done | 已办审批 | P0 |
| 我发起的 | /workflow/initiated | 我的申请 | P0 |
| 审批详情 | /workflow/approval/:id | 审批操作 | P0 |

---

### 3.6 全局审计与监控 (audit)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_audit_log | 操作审计日志 | 阶段3 |
| t_data_change_log | 数据变更日志 | 阶段3 |
| t_login_log | 登录日志 | 阶段3 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/audit/logs | GET | 操作日志查询 | P0 |
| /api/audit/logs/export | GET | 日志导出 | P1 |
| /api/audit/changes | GET | 数据变更查询 | P0 |
| /api/audit/logins | GET | 登录日志查询 | P0 |
| /api/audit/statistics | GET | 审计统计 | P1 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 操作日志 | /audit/logs | 操作审计查询 | P0 |
| 变更日志 | /audit/changes | 数据变更查询 | P0 |
| 登录日志 | /audit/logins | 登录记录查询 | P0 |
| 审计报表 | /audit/dashboard | 统计分析 | P1 |

---

### 3.7 消息通知中心 (notification)

#### 数据库表

| 表名 | 说明 | 开发阶段 |
|------|------|----------|
| t_message_template | 消息模板 | 阶段3 |
| t_message_log | 消息发送记录 | 阶段3 |
| t_notification | 站内通知 | 阶段3 |

#### API接口

| 接口 | 方法 | 说明 | 优先级 |
|------|------|------|--------|
| /api/message/templates | GET/POST | 模板管理 | P0 |
| /api/message/templates/{id} | GET/PUT/DELETE | 模板详情 | P0 |
| /api/message/send | POST | 发送消息 | P0 |
| /api/message/logs | GET | 发送记录 | P0 |
| /api/notifications | GET | 站内信列表 | P0 |
| /api/notifications/{id}/read | POST | 标记已读 | P0 |
| /api/notifications/read-all | POST | 全部已读 | P0 |

#### 前端页面

| 页面 | 路由 | 说明 | 优先级 |
|------|------|------|--------|
| 消息模板 | /message/templates | 模板管理 | P0 |
| 发送记录 | /message/logs | 发送历史 | P0 |
| 站内信 | /notifications | 通知列表 | P0 |

---

## 四、里程碑计划

### 4.1 里程碑节点

| 里程碑 | 时间节点 | 交付内容 | 验收标准 |
|--------|----------|----------|----------|
| M0 | Week 2 | 项目初始化完成 | 开发环境可用，CI/CD可运行 |
| M1 | Week 5 | 鉴权模块完成 | 可登录/登出，权限控制生效 |
| M2 | Week 8 | 调度模块完成 | 可创建定时任务，任务可执行 |
| M3 | Week 10 | 报表模块完成 | 可配置报表，可查询导出 |
| M4 | Week 12 | 配置模块完成 | 可动态管理配置，支持回滚 |
| M5 | Week 14 | 审批模块完成 | 可发起审批，可审批操作 |
| M6 | Week 16 | 审计模块完成 | 操作可追溯，日志可查询 |
| M7 | Week 18 | 消息模块完成 | 可发送多渠道消息 |
| M8 | Week 20 | 性能优化完成 | 接口响应P95<200ms |
| M9 | Week 21 | 安全加固完成 | 通过安全测试 |
| M10 | Week 22 | 正式上线 | 生产环境稳定运行 |

### 4.2 里程碑依赖关系

```
M0 ──▶ M1 ──▶ M2 ──┬──▶ M3 ──┬──▶ M6 ──▶ M8 ──▶ M9 ──▶ M10
                   │         │
                   ├──▶ M4 ──┤
                   │         │
                   └──▶ M5 ──┴──▶ M7
```

---

## 五、资源需求

### 5.1 人员配置

| 角色 | 人数 | 主要职责 |
|------|------|----------|
| 技术负责人 | 1 | 架构设计、技术决策、代码审查 |
| 后端开发 | 2-3 | API开发、业务逻辑实现 |
| 前端开发 | 2 | 页面开发、交互实现 |
| 测试工程师 | 1 | 测试用例、自动化测试 |
| DevOps | 1 | 环境搭建、部署运维 |

### 5.2 环境资源

| 环境 | 配置 | 用途 |
|------|------|------|
| 开发环境 | 本地Docker | 日常开发 |
| 测试环境 | 2C4G * 2 | 集成测试 |
| UAT环境 | 4C8G * 2 | 验收测试 |
| 生产环境 | 8C16G * 3 + 主从DB | 正式运行 |

---

## 六、风险管理

### 6.1 风险识别

| 风险 | 影响 | 可能性 | 应对措施 |
|------|------|--------|----------|
| 需求变更频繁 | 高 | 中 | 敏捷迭代、阶段评审、变更控制 |
| 技术选型问题 | 高 | 低 | 技术预研、POC验证 |
| 人员离职 | 中 | 低 | 文档完善、代码规范、知识共享 |
| 第三方依赖 | 中 | 中 | 接口抽象、备选方案 |
| 性能瓶颈 | 高 | 中 | 提前压测、预留优化时间 |
| 安全漏洞 | 高 | 中 | 安全培训、代码审计、渗透测试 |

### 6.2 风险应对

- **需求变更**：每个阶段结束进行需求确认，变更走正式流程
- **技术风险**：关键技术提前验证，保持技术栈稳定
- **人员风险**：核心模块结对开发，保持文档更新
- **进度风险**：预留10%缓冲时间，定期进度同步

---

## 七、质量保障

### 7.1 代码质量

| 措施 | 说明 |
|------|------|
| 代码规范 | ESLint + Pylint + Black 自动格式化 |
| 代码审查 | PR必须至少1人Review通过 |
| 单元测试 | 核心业务逻辑覆盖率 > 80% |
| 接口测试 | 所有API接口有自动化测试 |
| 静态分析 | SonarQube 代码质量检查 |

### 7.2 测试策略

| 测试类型 | 负责 | 时机 |
|----------|------|------|
| 单元测试 | 开发 | 编码时 |
| 接口测试 | 开发/测试 | API完成时 |
| 集成测试 | 测试 | 功能完成时 |
| 性能测试 | 测试/DevOps | 阶段4 |
| 安全测试 | 安全团队 | 阶段4 |
| UAT测试 | 业务方 | 上线前 |

### 7.3 交付标准

每个模块交付需满足：
- [ ] 功能完整，符合设计文档
- [ ] 单元测试通过，覆盖率达标
- [ ] 接口测试通过
- [ ] 代码审查通过
- [ ] 无P0/P1级Bug
- [ ] 接口文档完整

---

## 附录

### A. 术语表

| 术语 | 说明 |
|------|------|
| P0 | 最高优先级，必须完成 |
| P1 | 高优先级，应该完成 |
| P2 | 中优先级，有时间就做 |
| M0-M10 | 里程碑节点 |
| W1-W22 | 开发周次 |

### B. 参考文档

- 《系统设计文档》
- Django 官方文档
- Vue3 官方文档
- Ant Design Vue 组件库

---

*文档版本：v1.0*
*创建日期：2024年*
*最后更新：2024年*
